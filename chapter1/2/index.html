<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>使用 Kibana 分析开源项目的KPI - Elastic Stack Workshop</title><meta name=description content="搜索、观测、保护三大解决方案实战教程，各种级别和类型的学习资料，欢迎一起学习和共建。"><meta name=generator content="Hugo 0.94.2"><link href=https://elastic.martinliu.cn//index.xml rel=alternate type=application/rss+xml><link rel=canonical href=https://elastic.martinliu.cn/chapter1/2/><link rel=stylesheet href=https://elastic.martinliu.cn/css/theme.min.css><script src=https://use.fontawesome.com/releases/v5.0.6/js/all.js></script>
<link rel=stylesheet href=https://elastic.martinliu.cn/css/chroma.min.css><script src=https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script>
<script src=https://elastic.martinliu.cn/js/bundle.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-77731594-1"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-77731594-1")</script><style>:root{--custom-background-color:rgb(0,191,179)}</style><meta property="og:title" content="使用 Kibana 分析开源项目的KPI"><meta property="og:description" content="开源项目的火热程度取决于技术创新+行业趋势，很多风口浪尖的开源项目确实非常吸引人。GitHub中的项目好不好，是不是光数星星就够了？该如何洞"><meta property="og:type" content="article"><meta property="og:url" content="https://elastic.martinliu.cn/chapter1/2/"><meta property="og:image" content="https://elastic.martinliu.cn/images/elastic-stack-logo.png"><meta property="article:section" content="chapter1"><meta property="article:published_time" content="2017-10-17T15:26:15+00:00"><meta property="article:modified_time" content="2017-10-17T15:26:15+00:00"><meta property="og:site_name" content="Elastic Stack Workshop"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://elastic.martinliu.cn/images/elastic-stack-logo.png"><meta name=twitter:title content="使用 Kibana 分析开源项目的KPI"><meta name=twitter:description content="开源项目的火热程度取决于技术创新+行业趋势，很多风口浪尖的开源项目确实非常吸引人。GitHub中的项目好不好，是不是光数星星就够了？该如何洞"><meta itemprop=name content="使用 Kibana 分析开源项目的KPI"><meta itemprop=description content="开源项目的火热程度取决于技术创新+行业趋势，很多风口浪尖的开源项目确实非常吸引人。GitHub中的项目好不好，是不是光数星星就够了？该如何洞"><meta itemprop=datePublished content="2017-10-17T15:26:15+00:00"><meta itemprop=dateModified content="2017-10-17T15:26:15+00:00"><meta itemprop=wordCount content="3196"><meta itemprop=image content="https://elastic.martinliu.cn/images/elastic-stack-logo.png"><meta itemprop=keywords content></head><body><div class=container><header><h1>Elastic Stack Workshop</h1><span class=version>Version 0.1.5</span><a href=https://github.com/martinliu/elasticstack-workshop class=github><i class="fab fa-github"></i></a><p class=description>搜索、观测、保护三大解决方案实战教程，各种级别和类型的学习资料，欢迎一起学习和共建。</p></header><div class=global-menu><nav><ul><li><a href=/>首页</a></li><li><a href=/workshop/>教程</a></li><li><a href=/contribution/>贡献</a></li></ul></nav></div><div class=content-container><main><h1>使用 Kibana 分析开源项目的KPI</h1><p>开源项目的火热程度取决于技术创新+行业趋势，很多风口浪尖的开源项目确实非常吸引人。GitHub中的项目好不好，是不是光数星星就够了？该如何洞察一个项目的社区参与程度？如何判断核心开发团队的工作效能？为了回答这些深度的问题，还需要对其进行深度的分析。本教程教你使用 Elastic Stack 构建 GitHub 上开源项目的关键分析指标看板，在 Kibana 中详细分析项目的各个关键维度。</p><div class="panel panel-primary"><div class=panel-header><h3>学习目标</h3></div><div class=panel-body>1）使用 zip / tar.gz 软件包在本地搭建 Elastic Stack 开发环境；2） 使用 Filebeat 的 HTTP JSON inputedit 插件从 GitHub API 下载分析数据；3）在 Kibana 中查询和分析文档数据，为图形化展示做好准备；4）掌握 Kibana 数据分析展示看板的基本操作。</div></div><h2 id=准备工作>准备工作</h2><ol><li>在浏览器中打开网址 <a href=https://www.elastic.co/downloads/past-releases#elasticsearch>https://www.elastic.co/downloads/past-releases#elasticsearch</a> ； 下载 elasticsearch-7.17.0-darwin-aarch64.tar.gz 、kibana-7.17.0-darwin-aarch64.tar.gz 、 filebeat-7.17.0-darwin-x86_64.tar.gz 软件包。请自行选择正确的平台，以上 darwin-aarch64 软件包适用于 moacOS M1 平台；而 darwin-x86_64 软件包适用于 macOS Intel 平台。本视频演示的是下载 Windows 平台的 zip软件包</li><li>在 GitHub 中创建 personal token，用于提升访问 GitHub Api 下载的数据条数限制</li></ol><p><img src=/images/personal_access_token.png alt="github personal access token"></p><p>保存这个界面中的类似于这样的个人访问令牌 <code>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</code></p><h2 id=启动开发环境>启动开发环境</h2><p><strong>启动 Elasticsearch 服务器</strong>：下面是在 macOS M1 平台上解压缩 Elasticsearch 软件包，进入解压后的软件包的目录，使用其可执行文件启动服务。</p><pre tabindex=0><code>tar zxvf elasticsearch-7.17.0-darwin-aarch64.tar.gz
cd elasticsearch-7.17.0
bin/elasticsearch -Enode.name=mac-m1
</code></pre><p>如果是在 Windows 平台上，使用系统带的解压缩软件将 zip 软件包解压。</p><p><strong>启动 Kibana 服务器</strong>：</p><pre tabindex=0><code>tar zxvf kibana-7.17.0-darwin-aarch64.tar.gz
cd kibana-7.17.0-darwin-aarch64
bin/kibana
</code></pre><p>这样就启动了 Kibana 服务器，进入解压后的软件包的目录，使用其可执行文件启动服务。它默认会连接上一步所启动的 Elasticsearch 服务器，在这个开发环境中，默认没有启用用户名和密码认证。</p><p><strong>准备 Filebeat 的运行环境</strong>：解压缩 Filebeat 软件包，进入解压后的目录，备份默认的 <code>filebeat.yml</code> 重命名为 <code>filebeat.yml.bk</code>。</p><pre tabindex=0><code>tar zxvf filebeat-7.17.0-darwin-x86_64.tar.gz
cd filebeat-7.17.0-darwin-x86_64
mv filebeat.yml filebeat.yml.bk
</code></pre><p><strong>初始化 Kibana 的配置</strong>。在浏览器中输入 <code>http://localhost:5601</code> ，在登陆了 Kibana 之后，点击左上交的图标，打开左侧隐藏菜单，找到 Stack Management &ndash;> Kibana &ndash;> Advanced Setting 页面中的这两个选项。</p><ul><li>打开 “Dark mode” 选项，<strong>打开暗黑模式界面</strong>。</li></ul><p><img src=/images/kibana-dark-mode.png alt=kibana-dark-mode></p><ul><li>设置 “Document Explorer or classic view” 选项。<strong>关闭默认的 classic 经典视图模式</strong>。</li></ul><p><img src=/images/doc-explorer.png alt=doc-explorer></p><div class="panel panel-success"><div class=panel-header><h3>自查点</h3></div><div class=panel-body>已经成功的将 Elasticsearch 和 Kibana 在本机上，启动并运行正常。可以在浏览器中访问 Kibana 的界面。浏览若干重要的功能界面：Discover、Dashboard、DevTools、Stack Management等。</div></div><h2 id=下载参考配置文件>下载参考配置文件</h2><p>为了降低学习Kibana数据看板的搭建门槛，请下载准备好的示例文件。</p><a href=https://github.com/martinliu/sdp-dashboard/archive/refs/heads/main.zip class="button button-success"><i class="fas fa-cloud-download-alt"></i>&nbsp;下载</a><p>解压以上的zip文件后，其中的三个文件会被使用到：</p><ol><li>filebeat.yml ： 完整的 Filebeat 配置参数模版。用它替换 Filebeat 的默认配置文件。本示例配置文件分析的是 OpenShift 的 origin 项目，是一个非常火热的项目。需要几天时间才能完整下载所有数据，也可以根据需要将其替换。</li><li>add_gh_fields.json ： GitHub项目属性扩展字段定义。将其放入 Filebeat 程序文件夹的目录中。</li><li>export-v1.0.ndjson ： Kibana 可视化数据分析看板模版。将其倒入到新安装的 Kibana 中。</li></ol><p>以上三个文件适用于任何操作系统，</p><h2 id=使用-filebeat-同步数据>使用 Filebeat 同步数据</h2><p>Filebeat 包含多种数据摄入模块：</p><ul><li>AWS CloudWatch</li><li>AWS S3</li><li>Azure Event Hub</li><li>Cloud Foundry</li><li>Container</li><li>filestream</li><li>GCP Pub/Sub</li><li>HTTP Endpoint</li><li>HTTP JSON</li><li>journald</li><li>Kafka</li><li>Log</li><li>MQTT</li><li>NetFlow</li><li>Office 365 Management Activity API</li><li>Redis</li><li>Stdin</li><li>Syslog</li><li>TCP</li><li>UDP</li></ul><p>以上模块已经可以覆盖不少的数据源，灵活使用这些模块，就可以将 Filebeat 当作一个 mini 版的 Logstash 使用，当然 Logstash 包含了更丰富的摄入模块和数据处理能力。</p><h3 id=获取开源项目概要信息>获取开源项目概要信息</h3><p>本教程提供的示例配置文件，采集的是 OpenShift 的项目数据，你可以替换为你的目标分析项目。将下载示例配置文件中的 <code>add_gh_fields.json</code> 和 <code>filebeat.yml</code> 放入 Filebeat 的目录中 。</p><p>使用微软的 Virtual Studio Code 编辑器【或者其他的纯文本编辑器】打开 <code>filebeat.yml</code> 示例文件。查看该示例文件，并且<strong>删除掉中间的大部分内容</strong>「<strong>或者注释掉这部分先不用的代码</strong>」，留下剩余的部分做初始化测试。留下的部分如下所示。 并使用上面准备好的 GitHub Personal Access Token 替换配置文件中第21行中对应的参数。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#75715e>###################### Filebeat Configuration Example #########################</span>
</span></span><span style=display:flex><span><span style=color:#75715e># ============================== Filebeat inputs ===============================</span>
</span></span><span style=display:flex><span><span style=color:#f92672>filebeat.inputs</span>:
</span></span><span style=display:flex><span><span style=color:#75715e># ============================== 建议先获取这一部分的数据  ===============================</span>
</span></span><span style=display:flex><span><span style=color:#75715e># overall, contributors, releases, languages, tags 的数据少且重要，可以手工确认之后在做第二部分</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 获取项目的概要信息 - overall</span>
</span></span><span style=display:flex><span><span style=color:#75715e># GET /repos/{owner}/{repo}</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>type</span>: <span style=color:#ae81ff>httpjson</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>interval</span>: <span style=color:#ae81ff>120m</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>config_version</span>: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>request.url</span>: <span style=color:#ae81ff>https://api.github.com/repos/openshift/origin</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>request.method</span>: <span style=color:#ae81ff>GET </span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># 在请求中增加个人认证令牌，提高数据获取条数限制</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>request.transforms</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>set</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>target</span>: <span style=color:#ae81ff>header.Authorization</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#39;token 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&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># 使用数据处理器，修整数据</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>processors</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># 优化分析：增加方便搜索分析的字段  </span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>add_fields</span>: 
</span></span><span style=display:flex><span>        <span style=color:#f92672>fields</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>project</span>: <span style=color:#ae81ff>origin</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>kpi</span>: <span style=color:#ae81ff>overall</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 解码裸json结果：将 message 字段中的 json 内容解码为多个字段</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>decode_json_fields</span>: 
</span></span><span style=display:flex><span>        <span style=color:#f92672>fields</span>: [<span style=color:#e6db74>&#34;message&#34;</span>]
</span></span><span style=display:flex><span>        <span style=color:#f92672>target</span>: <span style=color:#e6db74>&#34;json&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ======================= Elasticsearch template setting =======================</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 配置索引模版基础属性</span>
</span></span><span style=display:flex><span><span style=color:#f92672>setup.template.overwrite</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span><span style=color:#f92672>setup.template.settings</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>index.number_of_shards</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>number_of_replicas</span>: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>index.mapping.total_fields.limit</span>: <span style=color:#ae81ff>5000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>setup.template.name</span>: <span style=color:#e6db74>&#34;filebeat&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>setup.template.pattern</span>: <span style=color:#e6db74>&#34;filebeat-*&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>setup.template.fields</span>: <span style=color:#e6db74>&#34;fields.yml&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 修改部分 json 字段默认的数据类型</span>
</span></span><span style=display:flex><span><span style=color:#f92672>setup.template.json.enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span><span style=color:#f92672>setup.template.json.path</span>: <span style=color:#e6db74>&#34;add_gh_fields.json&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>setup.template.json.name</span>: <span style=color:#e6db74>&#34;add_gh_fields&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 禁用ilm功能</span>
</span></span><span style=display:flex><span><span style=color:#f92672>setup.ilm.enabled</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span><span style=color:#75715e># ================================== General ===================================</span>
</span></span><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>github-crawler</span>
</span></span><span style=display:flex><span><span style=color:#75715e># ================================== Outputs ===================================</span>
</span></span><span style=display:flex><span><span style=color:#75715e># ---------------------------- Elasticsearch Output ----------------------------</span>
</span></span><span style=display:flex><span><span style=color:#f92672>output.elasticsearch</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>hosts</span>: [<span style=color:#e6db74>&#34;localhost:9200&#34;</span>]
</span></span><span style=display:flex><span>  <span style=color:#f92672>index</span>: <span style=color:#e6db74>&#34;filebeat-7&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># ================================= Processors =================================</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 删除 Filebeeat 采集到的无关数据，节省存储空间</span>
</span></span><span style=display:flex><span><span style=color:#f92672>processors</span>:
</span></span><span style=display:flex><span> - <span style=color:#f92672>drop_fields</span>:
</span></span><span style=display:flex><span>     <span style=color:#f92672>fields</span>: [<span style=color:#e6db74>&#34;ecs&#34;</span>, <span style=color:#e6db74>&#34;agent&#34;</span>, <span style=color:#e6db74>&#34;input&#34;</span>, <span style=color:#e6db74>&#34;host&#34;</span>, <span style=color:#e6db74>&#34;message&#34;</span>]    
</span></span><span style=display:flex><span><span style=color:#75715e># ================================== Logging ===================================</span>
</span></span><span style=display:flex><span><span style=color:#f92672>logging.level</span>: <span style=color:#ae81ff>debug</span>
</span></span><span style=display:flex><span><span style=color:#75715e># ============================= X-Pack Monitoring ==============================</span>
</span></span><span style=display:flex><span><span style=color:#75715e># monitoring.enabled: true     </span>
</span></span></code></pre></div><p>以上配置文件仅使用了必要的参数选项，目的是实现开源项目概要参数信息的抓取，并测试 Filebeat 的可用性(filebeat-7.17.0-darwin-x86_64.tar.gz是可以正常运行在macOS M1平台的)。</p><p>不论是 macOS，Windows 还是 Linux ，打开命令行工具，进入 Filebeat 的解压缩目录执行下面的测试。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>➜  filebeat-7.17.0-darwin-x86_64 ./filebeat test output
</span></span><span style=display:flex><span>elasticsearch: http://localhost:9200...
</span></span><span style=display:flex><span>  parse url... OK
</span></span><span style=display:flex><span>  connection...
</span></span><span style=display:flex><span>    parse host... OK
</span></span><span style=display:flex><span>    dns lookup... OK
</span></span><span style=display:flex><span>    addresses: ::1, 127.0.0.1
</span></span><span style=display:flex><span>    dial up... OK
</span></span><span style=display:flex><span>  TLS... WARN secure connection disabled
</span></span><span style=display:flex><span>  talk to server... OK
</span></span><span style=display:flex><span>  version: 7.17.0
</span></span></code></pre></div><p>命令 <code>./filebeat test output</code> 的返回结果表明：Filebeat 可以正常连接本机的 Elasticsearch 服务器。在Windows操作系统中，需要将 <code>filebeat</code> 可执行文件名换成 <code>filebeat.exe</code> ，后面的命令行参数不变。如果 filebeat.yml 配置文件的语法错误，这个命令中会报错。</p><h3 id=github-api-的限流和限速>GitHub API 的限流和限速</h3><p>使用 Filebeat 作为客户端访问 GitHub API需要了解的重要信息都在官方文档上：<a href=https://docs.github.com/en/rest/overview/resources-in-the-rest-api#rate-limiting>点这里</a>；本节内容是必须要理解的内容，必须要在运行 Filebeat 的操作系统上做的测试和操作。</p><ul><li>认证用户每小时的请求发送配额是 5000 次；对于比较流行的项目而言，issue 或 pull request 任意一类都可以轻易超过这个数值，建议使用 since 参数先拉取近期的数据分析，然后逐步拉取旧数据。</li><li>企业版用户的配额高一些，每个用户，每小时的配额是 15000 次。</li><li>未认证用户，每小时限制在60次请求。</li><li>建议在大概分析了 overall, contributors, releases, languages, tags，issues 和 pull request 等数据的条数后，在逐渐的开始逐项的采集各类数据。</li><li>可以用加大 page size 参数 【per_page 100是最大】的方式降低需要发出的请求次数。page size 越小，采集的项目数据量越大，越可能碰到被限流的情况。</li></ul><p>检查当前用户是否被限流的方法。在命令行里运行这条命令 <code>curl -u martinliu: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 -I https://api.github.com/users/octocat</code> ； 这个命令中 <code>-u martinliu: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</code> 包含了用户名和个人访问令牌（PAT）。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>➜ curl -u martinliu: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 -I https://api.github.com/users/octocat
</span></span><span style=display:flex><span>HTTP/2 <span style=color:#ae81ff>200</span>
</span></span><span style=display:flex><span>server: GitHub.com
</span></span><span style=display:flex><span>date: Thu, <span style=color:#ae81ff>17</span> Mar <span style=color:#ae81ff>2022</span> 11:01:02 GMT
</span></span><span style=display:flex><span>content-type: application/json; charset<span style=color:#f92672>=</span>utf-8
</span></span><span style=display:flex><span>content-length: <span style=color:#ae81ff>1335</span>
</span></span><span style=display:flex><span>cache-control: private, max-age<span style=color:#f92672>=</span>60, s-maxage<span style=color:#f92672>=</span><span style=color:#ae81ff>60</span>
</span></span><span style=display:flex><span>vary: Accept, Authorization, Cookie, X-GitHub-OTP
</span></span><span style=display:flex><span>etag: <span style=color:#e6db74>&#34;c9c3cea653b1e722852a41f65a43a5e969c0722c81525b3f1a27f7678269c6ba&#34;</span>
</span></span><span style=display:flex><span>last-modified: Tue, <span style=color:#ae81ff>22</span> Feb <span style=color:#ae81ff>2022</span> 15:07:13 GMT
</span></span><span style=display:flex><span>x-oauth-scopes: public_repo, repo:status
</span></span><span style=display:flex><span>x-accepted-oauth-scopes:
</span></span><span style=display:flex><span>github-authentication-token-expiration: 2022-04-15 06:47:45 UTC
</span></span><span style=display:flex><span>x-github-media-type: github.v3; format<span style=color:#f92672>=</span>json
</span></span><span style=display:flex><span>x-ratelimit-limit: <span style=color:#ae81ff>5000</span>
</span></span><span style=display:flex><span>x-ratelimit-remaining: <span style=color:#ae81ff>4440</span>
</span></span><span style=display:flex><span>x-ratelimit-reset: <span style=color:#ae81ff>1647516784</span>
</span></span><span style=display:flex><span>x-ratelimit-used: <span style=color:#ae81ff>560</span>
</span></span><span style=display:flex><span>x-ratelimit-resource: core
</span></span><span style=display:flex><span>access-control-expose-headers: ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Resource, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, X-GitHub-SSO, X-GitHub-Request-Id, Deprecation, Sunset
</span></span><span style=display:flex><span>access-control-allow-origin: *
</span></span><span style=display:flex><span>strict-transport-security: max-age<span style=color:#f92672>=</span>31536000; includeSubdomains; preload
</span></span><span style=display:flex><span>x-frame-options: deny
</span></span><span style=display:flex><span>x-content-type-options: nosniff
</span></span><span style=display:flex><span>x-xss-protection: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>referrer-policy: origin-when-cross-origin, strict-origin-when-cross-origin
</span></span><span style=display:flex><span>content-security-policy: default-src <span style=color:#e6db74>&#39;none&#39;</span>
</span></span><span style=display:flex><span>vary: Accept-Encoding, Accept, X-Requested-With
</span></span><span style=display:flex><span>x-github-request-id: 4664:4A3B:121A47C:12EB215:623314EE
</span></span></code></pre></div><p>结果中的这几个参数最重要：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>* x-ratelimit-limit: 是 <span style=color:#ae81ff>5000</span> 表明用户名和PAT是正确的，如果是 <span style=color:#ae81ff>60</span> 表明，这个用户名和token组合错误，为认证用户的限制是 60。
</span></span><span style=display:flex><span>* x-ratelimit-remaining: <span style=color:#ae81ff>4440</span> 当前这个小时里的剩余API请求数。
</span></span><span style=display:flex><span>* x-ratelimit-reset: <span style=color:#ae81ff>1647516784</span> 下一次访问限制被重置的时间。
</span></span></code></pre></div><p>在采集数据之前，确认能看到类似于以上的数据，否则不要继续做下面的步骤。</p><p>基于 GitHub API 使用的限流特性，建议分类，分时段采集数据，避免发生被限流的状况。</p><p>在使用 Filebeat 的 HTTP JSON 模块采集 GitHub API数据的过程中很难不会碰到被限流的情况（请求），在被限流的时候，可以在 filebeat 的滚动日志中看到类似下面的信息。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>2022-03-17T11:22:53.262+0800	ERROR	<span style=color:#f92672>[</span>input.httpjson-stateless<span style=color:#f92672>]</span>	v2/input.go:115	Error <span style=color:#66d9ef>while</span> processing http request: failed to execute http client.Do: server responded with status code 403: <span style=color:#f92672>{</span><span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;Resource protected by organization SAML enforcement. You must grant your Personal Access token access to this organization.&#34;</span>,<span style=color:#e6db74>&#34;documentation_url&#34;</span>:<span style=color:#e6db74>&#34;https://docs.github.com/articles/authenticating-to-a-github-organization-with-saml-single-sign-on/&#34;</span><span style=color:#f92672>}</span>	<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;id&#34;</span>: <span style=color:#e6db74>&#34;BF2B0C218CAC3BA0&#34;</span>, <span style=color:#e6db74>&#34;input_url&#34;</span>: <span style=color:#e6db74>&#34;https://api.github.com/repos/elastic/beats/releases&#34;</span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>以上信息表明，你当前的账户访问被限流了，你需要等一个小时后，在让 Filebeat 继续采集数据。</p><div class="panel panel-success"><div class=panel-header><h3>自查点</h3></div><div class=panel-body>你已经理解了 GitHub API 访问流控的基本知识。完成了在正式采集数据前的必要测试，已经确认当前用户名和PAT是正确无误。在浏览器中提前测试 filebeat.yml 配置文件中的 request.rul，确保所有 URL 都可以正常返回结果。 可选的测试：在操作系统上用clone的方式下载一个自己的项目，修改某个文件后，将更新push回去，确保和 GitHub 网站的服务是正常的。</div></div><p>下一步开始进行数据初始化前的准备基础准备工作。</p><h3 id=采集并确认部分项目数据>采集并确认部分项目数据</h3><p>在导入数据之前，需要完成下面这几项任务：</p><ol><li>导入为大家准备好的 Kibana 配置文件。</li><li>在配置文件中只开启 overall 部分的数据采集</li><li>首次启动 Filebeat ，并停止它</li><li>在 Kibana 中确认采集到的数据</li><li>为了大批量数据采集，修改索引字段数量上限</li></ol><p>下面详细讲解操作过程。</p><p>在解压缩后的 zip 文件中，找到 export-v1.0.ndjson 文件；在浏览器中打开 Kibana 的界面，点击左侧菜单：需要导入示例 Kibana 可视化对象。文件在</p><h2 id=定制项目数据分析看板>定制项目数据分析看板</h2><h2 id=总结>总结</h2><div class=edit-meta>Last updated on 2017-10-17<br>Published on 2017-10-17<br><a href=https://github.com/martinliu/elasticstack-workshop/edit/master/content/chapter1/2.md class=edit-page><i class="fas fa-pen-square"></i>&nbsp;Edit on GitHub</a></div><nav class=pagination><a class="nav nav-prev" href=https://elastic.martinliu.cn/chapter1/1/ title="在 CentOS 上安装 Elastic Stack 7.16"><i class="fas fa-arrow-left" aria-hidden=true></i>&nbsp;Prev - 在 CentOS 上安装 Elastic Stack 7.16</a>
<a class="nav nav-next" href=https://elastic.martinliu.cn/chapter1/3/ title="Chapter 1-3">Next - Chapter 1-3 <i class="fas fa-arrow-right" aria-hidden=true></i></a></nav><footer><p class=powered>Powered by <a href=https://gohugo.io>Hugo</a>. Theme by <a href=https://themes.gohugo.io/hugo-theme-techdoc/>TechDoc</a>. Designed by <a href=https://github.com/thingsym/hugo-theme-techdoc>Thingsym</a>.</p></footer></main><div class=sidebar><nav class=slide-menu><ul><li><a href=https://elastic.martinliu.cn/>Home</a></li><li class=has-sub-menu><a href=https://elastic.martinliu.cn/getting-started/>新手入门<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://elastic.martinliu.cn/getting-started/configuration/>Configuration</a></li><li><a href=https://elastic.martinliu.cn/getting-started/screenshot/>Screenshot</a></li><li class=has-sub-menu><a href=https://elastic.martinliu.cn/getting-started/local/>本地安装<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://elastic.martinliu.cn/getting-started/local/installation-macos/>MacOS 本地安装</a></li><li><a href=https://elastic.martinliu.cn/getting-started/local/installation-linux/>Linux 本地安装</a></li><li><a href=https://elastic.martinliu.cn/getting-started/local/installation-win/>Windows 本地安装</a></li></ul></li></ul></li><li class="parent has-sub-menu"><a href=https://elastic.martinliu.cn/chapter1/>新手 100 系列<span class="mark opened">-</span></a><ul class=sub-menu><li><a href=https://elastic.martinliu.cn/chapter1/1/>在 CentOS 上安装 Elastic Stack 7.16</a></li><li class=active><a href=https://elastic.martinliu.cn/chapter1/2/>使用 Kibana 分析开源项目的KPI</a></li><li><a href=https://elastic.martinliu.cn/chapter1/3/>Chapter 1-3</a></li><li><a href=https://elastic.martinliu.cn/chapter1/4/>Chapter 1-4</a></li></ul></li><li class=has-sub-menu><a href=https://elastic.martinliu.cn/chapter2/>Chapter 2 (weighted)<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://elastic.martinliu.cn/chapter2/3/>Chapter 2-3 (weight: 10)</a></li><li><a href=https://elastic.martinliu.cn/chapter2/4/>Chapter 2-4 (weight: 20)</a></li><li><a href=https://elastic.martinliu.cn/chapter2/2/>Chapter 2-2 (weight: 30)</a></li><li><a href=https://elastic.martinliu.cn/chapter2/1/>Chapter 2-1 (weight: 40)</a></li><li><a href=https://elastic.martinliu.cn/chapter2/5/>Chapter 2-0 (weight: no set)</a></li></ul></li><li class=has-sub-menu><a href=https://elastic.martinliu.cn/chapter3/>Chapter 3 (hierarchized)<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://elastic.martinliu.cn/chapter3/1/>Chapter 3-1</a></li><li class=has-sub-menu><a href=https://elastic.martinliu.cn/chapter3/chapter3-2/>Chapter 3-2<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://elastic.martinliu.cn/chapter3/chapter3-2/1/>Chapter 3-2-1</a></li><li><a href=https://elastic.martinliu.cn/chapter3/chapter3-2/2/>Chapter 3-2-2</a></li><li><a href=https://elastic.martinliu.cn/chapter3/chapter3-2/3/>Chapter 3-2-3</a></li><li><a href=https://elastic.martinliu.cn/chapter3/chapter3-2/4/>Chapter 3-2-4</a></li></ul></li><li><a href=https://elastic.martinliu.cn/chapter3/3/>Chapter 3-3</a></li><li><a href=https://elastic.martinliu.cn/chapter3/4/>Chapter 3-4</a></li></ul></li><li class=has-sub-menu><a href=https://elastic.martinliu.cn/chapter4/>Chapter 4 (unlimited levels)<span class="mark closed">+</span></a><ul class=sub-menu><li class=has-sub-menu><a href=https://elastic.martinliu.cn/chapter4/chapter4-1/>Chapter 4-1<span class="mark closed">+</span></a><ul class=sub-menu><li class=has-sub-menu><a href=https://elastic.martinliu.cn/chapter4/chapter4-1/chapter4-1-1/>Chapter 4-1-1<span class="mark closed">+</span></a><ul class=sub-menu><li class=has-sub-menu><a href=https://elastic.martinliu.cn/chapter4/chapter4-1/chapter4-1-1/chapter4-1-1-1/>Chapter 4-1-1-1<span class="mark closed">+</span></a><ul class=sub-menu><li class=has-sub-menu><a href=https://elastic.martinliu.cn/chapter4/chapter4-1/chapter4-1-1/chapter4-1-1-1/chapter4-1-1-1-1/>Chapter 4-1-1-1-1<span class="mark closed">+</span></a><ul class=sub-menu><li class=has-sub-menu><a href=https://elastic.martinliu.cn/chapter4/chapter4-1/chapter4-1-1/chapter4-1-1-1/chapter4-1-1-1-1/chapter4-1-1-1-1-1/>Chapter 4-1-1-1-1-1<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://elastic.martinliu.cn/chapter4/chapter4-1/chapter4-1-1/chapter4-1-1-1/chapter4-1-1-1-1/chapter4-1-1-1-1-1/chapter4-1-1-1-1-1-1/>Chapter 4-1-1-1-1-1-1</a></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li><li class=has-sub-menu><a href=https://elastic.martinliu.cn/sample/>编写规范<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://elastic.martinliu.cn/sample/markdown-syntax/>MD基础语法</a></li><li><a href=https://elastic.martinliu.cn/sample/table-of-contents/>内容目录</a></li><li><a href=https://elastic.martinliu.cn/sample/build-in-shortcodes/>内置短代码</a></li><li><a href=https://elastic.martinliu.cn/sample/custom-shortcodes/>自定义短代码</a></li><li><a href=https://elastic.martinliu.cn/sample/search-shortcode/>搜索短代码</a></li></ul></li></ul></nav><div class=sidebar-footer></div></div></div><a href=# id=backtothetop-fixed class=backtothetop data-backtothetop-duration=600 data-backtothetop-easing=easeOutQuart data-backtothetop-fixed-fadein=1000 data-backtothetop-fixed-fadeout=1000 data-backtothetop-fixed-bottom=10 data-backtothetop-fixed-right=20><span class="fa-layers fa-fw"><i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i></span></a></div></body></html>