<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>在 macOS 上运行 Elasticsearch 8.1.0 - Elastic Stack Workshop | 刘征 Developer Advocate @ Elastic</title><meta name=description content="搜索、观测、保护三大解决方案实战教程，各种级别和类型的学习资料，欢迎一起学习和共建。"><meta name=generator content="Hugo 0.95.0"><link href=https://elastic.martinliu.cn//index.xml rel=alternate type=application/rss+xml><link rel=canonical href=https://elastic.martinliu.cn/chapter3/chapter3-1/1/><link rel=stylesheet href=https://elastic.martinliu.cn/css/theme.min.css><script src=https://use.fontawesome.com/releases/v5.0.6/js/all.js></script>
<link rel=stylesheet href=https://elastic.martinliu.cn/css/chroma.min.css><script src=https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script>
<script src=https://elastic.martinliu.cn/js/bundle.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-77731594-1"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-77731594-1")</script><style>:root{--custom-background-color:rgb(0,191,179)}</style><meta property="og:title" content="在 macOS 上运行 Elasticsearch 8.1.0"><meta property="og:description" content="在 macOS 上运行 Elasticsearch 的目标往往是开发。 运行 macOS 操作系统的苹果电脑的 CPU 可能是 Intel 或者是 M1芯片。 Elasticsearch 在这两种平台上，使用的软件包是不同的。 Intel : darwin-x86_64.tar.gz M1 : darwin-aarch64.tar.gz 访问官"><meta property="og:type" content="article"><meta property="og:url" content="https://elastic.martinliu.cn/chapter3/chapter3-1/1/"><meta property="og:image" content="https://elastic.martinliu.cn/images/elastic-stack-logo.png"><meta property="article:section" content="chapter3"><meta property="article:published_time" content="2017-03-19T15:26:15+00:00"><meta property="article:modified_time" content="2017-03-19T15:26:15+00:00"><meta property="og:site_name" content="Elastic Stack Workshop"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://elastic.martinliu.cn/images/elastic-stack-logo.png"><meta name=twitter:title content="在 macOS 上运行 Elasticsearch 8.1.0"><meta name=twitter:description content="在 macOS 上运行 Elasticsearch 的目标往往是开发。 运行 macOS 操作系统的苹果电脑的 CPU 可能是 Intel 或者是 M1芯片。 Elasticsearch 在这两种平台上，使用的软件包是不同的。 Intel : darwin-x86_64.tar.gz M1 : darwin-aarch64.tar.gz 访问官"><meta itemprop=name content="在 macOS 上运行 Elasticsearch 8.1.0"><meta itemprop=description content="在 macOS 上运行 Elasticsearch 的目标往往是开发。 运行 macOS 操作系统的苹果电脑的 CPU 可能是 Intel 或者是 M1芯片。 Elasticsearch 在这两种平台上，使用的软件包是不同的。 Intel : darwin-x86_64.tar.gz M1 : darwin-aarch64.tar.gz 访问官"><meta itemprop=datePublished content="2017-03-19T15:26:15+00:00"><meta itemprop=dateModified content="2017-03-19T15:26:15+00:00"><meta itemprop=wordCount content="1597"><meta itemprop=image content="https://elastic.martinliu.cn/images/elastic-stack-logo.png"><meta itemprop=keywords content="elasticsearch,macOS,"></head><body><div class=container><header><h1>Elastic Stack Workshop | 刘征 Developer Advocate @ Elastic</h1><span class=version>Version 0.2.5</span><a href=https://github.com/martinliu/elasticstack-workshop class=github><i class="fab fa-github"></i></a><p class=description>搜索、观测、保护三大解决方案实战教程，各种级别和类型的学习资料，欢迎一起学习和共建。</p></header><div class=global-menu><nav><ul><li><a href=/>首页</a></li><li><a href=https://martinliu.cn>博客</a></li><li><a href=/workshop/>教程</a></li><li><a href=/contribution/>贡献</a></li></ul></nav></div><div class=content-container><main><h1>在 macOS 上运行 Elasticsearch 8.1.0</h1><p>在 macOS 上运行 Elasticsearch 的目标往往是开发。 运行 macOS 操作系统的苹果电脑的 CPU 可能是 Intel 或者是 M1芯片。 Elasticsearch 在这两种平台上，使用的软件包是不同的。</p><ul><li>Intel : darwin-x86_64.tar.gz</li><li>M1 : darwin-aarch64.tar.gz</li></ul><p>访问官方下载页面：<a href=https://www.elastic.co/downloads/past-releases/elasticsearch-8-1-0>https://www.elastic.co/downloads/past-releases/elasticsearch-8-1-0</a> 下载对应的软件包到本地的目录中。</p><p>学习目标：</p><ol><li>在本地模拟运行三节点 Elasticsearch 集群</li><li>修改 Elasticsearch 内置管理员用户 elastic 的密码</li><li>运行 Kibana 服务，启用内置的 Elastic Stack 监控功能</li></ol><p>将下载的软件包放在名为 <code>lab2</code> 的目录中，并在这个目录中创建三个空目录：node1 、 node2 和 node3。</p><p>打开命令行工具，进入 <code>lab2</code> 目录中，将 Elasticsearch 软件包解压缩三次，放在不同的目录中备用。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>tar zxf elasticsearch-8.1.0-darwin-x86_64.tar.gz -C node1
</span></span><span style=display:flex><span>tar zxf elasticsearch-8.1.0-darwin-x86_64.tar.gz -C node2
</span></span><span style=display:flex><span>tar zxf elasticsearch-8.1.0-darwin-x86_64.tar.gz -C node3
</span></span></code></pre></div><p>打开一个新的命令行窗口，进入 node1 的 Elasticsearch 目录中，运行下面这条命令。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>bin/elasticsearch -Ecluster.name<span style=color:#f92672>=</span>3m -Enode.name<span style=color:#f92672>=</span>node1
</span></span></code></pre></div><p>参数解释：</p><ul><li>cluster.name=3m 设定集群的名称为 3m</li><li>node.name=node1 设定本节点的名称为 node1</li></ul><p>在以上滚动输出的日志信息中，复制粘贴类似于下面的部分到一个文本编辑器中。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
</span></span><span style=display:flex><span>✅ Elasticsearch security features have been automatically configured!
</span></span><span style=display:flex><span>✅ Authentication is enabled and cluster connections are encrypted.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ℹ️  Password <span style=color:#66d9ef>for</span> the elastic user <span style=color:#f92672>(</span>reset with <span style=color:#e6db74>`</span>bin/elasticsearch-reset-password -u elastic<span style=color:#e6db74>`</span><span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>  FpGuIiBoQ_Sgj5D6bO*R
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ℹ️  HTTP CA certificate SHA-256 fingerprint:
</span></span><span style=display:flex><span>  95a720bb818071e8dd6bf0b7ec3d0c586d582d1312ff60f2b2eb586a143e7c20
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ℹ️  Configure Kibana to use this cluster:
</span></span><span style=display:flex><span>• Run Kibana and click the configuration link in the terminal when Kibana starts.
</span></span><span style=display:flex><span>• Copy the following enrollment token and paste it into Kibana in your browser <span style=color:#f92672>(</span>valid <span style=color:#66d9ef>for</span> the next <span style=color:#ae81ff>30</span> minutes<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>  eyJ2ZXIiOiI4LjEuMCIsImFkciI6WyIxOTIuMTY4LjMxLjEyNTo5MjAwIl0sImZnciI6Ijk1YTcyMGJiODE4MDcxZThkZDZiZjBiN2VjM2QwYzU4NmQ1ODJkMTMxMmZmNjBmMmIyZWI1ODZhMTQzZTdjMjAiLCJrZXkiOiI2N1Y0blg4QnhZMkxEbllNc2YtMTpBSWVoS21WSlNReUJMUnphUUE5TDNBIn0<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ℹ️  Configure other nodes to join this cluster:
</span></span><span style=display:flex><span>• On this node:
</span></span><span style=display:flex><span>  ⁃ Create an enrollment token with <span style=color:#e6db74>`</span>bin/elasticsearch-create-enrollment-token -s node<span style=color:#e6db74>`</span>.
</span></span><span style=display:flex><span>  ⁃ Uncomment the transport.host setting at the end of config/elasticsearch.yml.
</span></span><span style=display:flex><span>  ⁃ Restart Elasticsearch.
</span></span><span style=display:flex><span>• On other nodes:
</span></span><span style=display:flex><span>  ⁃ Start Elasticsearch with <span style=color:#e6db74>`</span>bin/elasticsearch --enrollment-token &lt;token&gt;<span style=color:#e6db74>`</span>, using the enrollment token that you generated.
</span></span><span style=display:flex><span>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
</span></span></code></pre></div><p>这样就成功的启动了 3m 集群里的首个节点，以上启动过程，完成了几件重要的系统安全保障工作。</p><ul><li>为 elastic 用户创建了随机密码</li><li>为 Elasticsearch 集群创建了一套节点间加密传授的数字证书</li><li>为 Kibana 服务器创建了注册配置令牌</li><li>给出了其它 Elasticsearch 节点加入这个 3m 集群的操作方法</li></ul><p>由于随机生成的用户密码不方便使用，使用下面的命令修改 elastic 用户的密码。打开一个新的命令行窗口，进入 node1 的 Elasticsearch 目录里。执行命令 <code>bin/elasticsearch-reset-password -u elastic -i</code> 。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span> ~/Downloads/elk/lab2/node1/elasticsearch-8.1.0  bin/elasticsearch-reset-password -u elastic -i
</span></span><span style=display:flex><span>This tool will reset the password of the <span style=color:#f92672>[</span>elastic<span style=color:#f92672>]</span> user.
</span></span><span style=display:flex><span>You will be prompted to enter the password.
</span></span><span style=display:flex><span>Please confirm that you would like to <span style=color:#66d9ef>continue</span> <span style=color:#f92672>[</span>y/N<span style=color:#f92672>]</span>y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Enter password <span style=color:#66d9ef>for</span> <span style=color:#f92672>[</span>elastic<span style=color:#f92672>]</span>:
</span></span><span style=display:flex><span>Re-enter password <span style=color:#66d9ef>for</span> <span style=color:#f92672>[</span>elastic<span style=color:#f92672>]</span>:
</span></span><span style=display:flex><span>Password <span style=color:#66d9ef>for</span> the <span style=color:#f92672>[</span>elastic<span style=color:#f92672>]</span> user successfully reset.
</span></span></code></pre></div><p>上面就成功的修改了 elastic 用户的密码，记录该密码备用。在这个命令行窗口中运行 <code>bin/elasticsearch-create-enrollment-token -s node</code> 命令。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span> ~/Downloads/elk/lab2/node1/elasticsearch-8.1.0  bin/elasticsearch-create-enrollment-token -s node
</span></span><span style=display:flex><span>eyJ2ZXIiOiI4LjEuMCIsImFkciI6WyIxOTIuMTY4LjMxLjEyNTo5MjAwIl0sImZnciI6Ijk1YTcyMGJiODE4MDcxZThkZDZiZjBiN2VjM2QwYzU4NmQ1ODJkMTMxMmZmNjBmMmIyZWI1ODZhMTQzZTdjMjAiLCJrZXkiOiJzN2FIblg4QnhZMkxEbllNS3dCaDowT0RIYlE3OFQyV2ZGTmxKODFfUjRnIn0<span style=color:#f92672>=</span>
</span></span></code></pre></div><p>在上面的命令行输出信息中，复制所产生的集群加群令牌，备用。</p><p>修改首个节点 node1 的配置文件，在 node1 目录中，用编辑器打开配置文件 <code>config/elasticsearch.yml</code> ，搜索到 <code>transport.host</code> 这个参数所在的行，将本行的注释取消。回到 node1 的 Elasticsearch 服务启动的命令行窗口中，按 <code>ctrl + c</code> 停止 Elasticsearch 服务，然后在启动该节点。</p><p>打开新的命令行窗口，进入 lab2 目录，解压缩 Kibana 软件包，进入 Kibana 目录，然后启动 Kibana 服务器。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>~/Downloads/elk/lab2  tar zxf kibana-8.1.0-darwin-x86_64.tar.gz
</span></span><span style=display:flex><span>cd kibana-8.1.0
</span></span><span style=display:flex><span>bin/kibana
</span></span></code></pre></div><p>在 Kibana 服务器正常启动之后，打开一个浏览器，输入 Kibana 的访问地址：<code>http://localhost:5601</code>；在 Kibana 的首次登陆配置界面中粘贴入 node1 节点首次启动时所生成的 Kibana 注册令牌，然后点击 ”Configure Elastic“ 按钮。等待 Kibana 配置完毕之后，使用 elastic 用户登录 Kibna。</p><p>在 Kibana 左侧菜单中，点击 Management -> Stack Montitoring ，选择启用集群自监控功能。然后进入 3m 集群的节点监控界面。如下图所示。</p><p><img src=/images/ch3/2022-03-19_01-00-24.png alt></p><p>执行后续的操作，观察 node2 和 node3 的出现。</p><p>下面开始模拟 node2 和 node3 加入 3m 集群。</p><p>打开新的命令行窗口，进入 node2 的 Elasticsearch 目录中。执行下面的命令，注意这里所使用的 token 是上面的命令所生成的。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>bin/elasticsearch -Ecluster.name<span style=color:#f92672>=</span>3m -Enode.name<span style=color:#f92672>=</span>node2 --enrollment-token  eyJ2ZXIiOiI4LjEuMCIsImFkciI6WyIxOTIuMTY4LjMxLjEyNTo5MjAwIl0sImZnciI6Ijk1YTcyMGJiODE4MDcxZThkZDZiZjBiN2VjM2QwYzU4NmQ1ODJkMTMxMmZmNjBmMmIyZWI1ODZhMTQzZTdjMjAiLCJrZXkiOiJzN2FIblg4QnhZMkxEbllNS3dCaDowT0RIYlE3OFQyV2ZGTmxKODFfUjRnIn0<span style=color:#f92672>=</span>
</span></span></code></pre></div><p>打开新的命令行窗口，进入 node3 的 Elasticsearch 目录中。执行下面的命令，注意这里所使用的 token 是上面的命令所生成的。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>bin/elasticsearch -Ecluster.name<span style=color:#f92672>=</span>3m -Enode.name<span style=color:#f92672>=</span>node3 --enrollment-token  eyJ2ZXIiOiI4LjEuMCIsImFkciI6WyIxOTIuMTY4LjMxLjEyNTo5MjAwIl0sImZnciI6Ijk1YTcyMGJiODE4MDcxZThkZDZiZjBiN2VjM2QwYzU4NmQ1ODJkMTMxMmZmNjBmMmIyZWI1ODZhMTQzZTdjMjAiLCJrZXkiOiJzN2FIblg4QnhZMkxEbllNS3dCaDowT0RIYlE3OFQyV2ZGTmxKODFfUjRnIn0<span style=color:#f92672>=</span>
</span></span></code></pre></div><p>在 Elastic Stack 集群自监控界面上，确认 3m 集群里所加入的两个新的节点。</p><div class=edit-meta>Last updated on 2017-03-19<br>Published on 2017-03-19<br><a href=https://github.com/martinliu/elasticstack-workshop/edit/master/content/chapter3/chapter3-1/1.md class=edit-page><i class="fas fa-pen-square"></i>&nbsp;Edit on GitHub</a></div><nav class=pagination><a class="nav nav-prev" href=https://elastic.martinliu.cn/chapter3/chapter3-1/ title=Elasticsearch><i class="fas fa-arrow-left" aria-hidden=true></i>&nbsp;Prev - Elasticsearch</a>
<a class="nav nav-next" href=https://elastic.martinliu.cn/chapter3/chapter3-1/2/ title="在 Windows 10 上运行 Elasticsearch 8.1.0">Next - 在 Windows 10 上运行 Elasticsearch 8.1.0 <i class="fas fa-arrow-right" aria-hidden=true></i></a></nav><footer><p class=powered>Powered by <a href=https://gohugo.io>Hugo</a>. Theme by <a href=https://themes.gohugo.io/hugo-theme-techdoc/>TechDoc</a>. Designed by <a href=https://github.com/thingsym/hugo-theme-techdoc>Thingsym</a>.</p></footer></main><div class=sidebar><nav class=slide-menu><ul><li><a href=https://elastic.martinliu.cn/>Home</a></li><li class=has-sub-menu><a href=https://elastic.martinliu.cn/getting-started/>新手入门<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://elastic.martinliu.cn/getting-started/configuration/>Configuration</a></li><li><a href=https://elastic.martinliu.cn/getting-started/screenshot/>Screenshot</a></li><li class=has-sub-menu><a href=https://elastic.martinliu.cn/getting-started/local/>本地安装<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://elastic.martinliu.cn/getting-started/local/installation-macos/>MacOS 本地安装</a></li><li><a href=https://elastic.martinliu.cn/getting-started/local/installation-linux/>Linux 本地安装</a></li><li><a href=https://elastic.martinliu.cn/getting-started/local/installation-win/>Windows 本地安装</a></li></ul></li></ul></li><li class=has-sub-menu><a href=https://elastic.martinliu.cn/chapter1/>新手 100 系列<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://elastic.martinliu.cn/chapter1/1/>在 CentOS 上安装 Elastic Stack 7.16</a></li><li><a href=https://elastic.martinliu.cn/chapter1/2/>洞察 GitHub 中开源项目的开发效能</a></li><li><a href=https://elastic.martinliu.cn/chapter1/3/>Chapter 1-3</a></li><li><a href=https://elastic.martinliu.cn/chapter1/4/>Chapter 1-4</a></li></ul></li><li class=has-sub-menu><a href=https://elastic.martinliu.cn/sample/>编写规范<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://elastic.martinliu.cn/sample/markdown-syntax/>MD基础语法</a></li><li><a href=https://elastic.martinliu.cn/sample/table-of-contents/>内容目录</a></li><li><a href=https://elastic.martinliu.cn/sample/build-in-shortcodes/>内置短代码</a></li><li><a href=https://elastic.martinliu.cn/sample/custom-shortcodes/>自定义短代码</a></li><li><a href=https://elastic.martinliu.cn/sample/search-shortcode/>搜索短代码</a></li></ul></li><li class="parent has-sub-menu"><a href=https://elastic.martinliu.cn/chapter3/>Mini 系列<span class="mark opened">-</span></a><ul class=sub-menu><li><a href=https://elastic.martinliu.cn/chapter3/beats/3/>Beats</a></li><li class="parent has-sub-menu"><a href=https://elastic.martinliu.cn/chapter3/chapter3-1/>Elasticsearch<span class="mark opened">-</span></a><ul class=sub-menu><li class=active><a href=https://elastic.martinliu.cn/chapter3/chapter3-1/1/>在 macOS 上运行 Elasticsearch 8.1.0</a></li><li><a href=https://elastic.martinliu.cn/chapter3/chapter3-1/2/>在 Windows 10 上运行 Elasticsearch 8.1.0</a></li><li><a href=https://elastic.martinliu.cn/chapter3/chapter3-1/3/>在 Linux 上运行 Elasticsearch 8.1.0</a></li><li><a href=https://elastic.martinliu.cn/chapter3/chapter3-1/4/>使用 rpm/deb 软件包安装 Elasticsearch 8.1.0</a></li><li><a href=https://elastic.martinliu.cn/chapter3/chapter3-1/5/>使用 Docker 运行 Elasticsearch 8.1.0</a></li></ul></li><li><a href=https://elastic.martinliu.cn/chapter3/enterprise-search/5/>Enterprise Search</a></li><li class=has-sub-menu><a href=https://elastic.martinliu.cn/chapter3/chapter3-2/>Kibana<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://elastic.martinliu.cn/chapter3/chapter3-2/2/>Chapter 3-2-2</a></li><li><a href=https://elastic.martinliu.cn/chapter3/chapter3-2/3/>Chapter 3-2-3</a></li><li><a href=https://elastic.martinliu.cn/chapter3/chapter3-2/4/>Chapter 3-2-4</a></li><li><a href=https://elastic.martinliu.cn/chapter3/chapter3-2/1/>在 macOS 上运行 Kibana</a></li></ul></li><li><a href=https://elastic.martinliu.cn/chapter3/logstash/4/>Logstash</a></li></ul></li></ul></nav><div class=sidebar-footer></div></div></div><a href=# id=backtothetop-fixed class=backtothetop data-backtothetop-duration=600 data-backtothetop-easing=easeOutQuart data-backtothetop-fixed-fadein=1000 data-backtothetop-fixed-fadeout=1000 data-backtothetop-fixed-bottom=10 data-backtothetop-fixed-right=20><span class="fa-layers fa-fw"><i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i></span></a></div></body></html>