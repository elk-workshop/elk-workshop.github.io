
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>æ­å»ºå•èŠ‚ç‚¹ Elasticsearch é›†ç¾¤æœåŠ¡</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid="UA-159133967-1"
                  id="one-nodes-es-server"
                  title="æ­å»ºå•èŠ‚ç‚¹ Elasticsearch é›†ç¾¤æœåŠ¡"
                  environment="web"
                  feedback-link="https://martinliu.cn">
    
      <google-codelab-step label="æ¦‚è¿°" duration="1">
        <h2 is-upgraded>å­¦ä¹ æ”¶ç›Š</h2>
<p>ä½ å°†å­¦ä¹ åˆ°ä»¥ä¸‹æŠ€èƒ½ï¼š</p>
<ol type="1">
<li>ä¸‹è½½å¹¶è¿è¡Œ Elasticsearch æœåŠ¡å™¨</li>
<li>åœ¨æœåŠ¡å™¨ä¸­ç´¢å¼•ä¸€äº›æ–‡æ¡£ï¼ˆä½¿ç”¨ _index APIï¼‰</li>
<li>ä½“éªŒæœç´¢æŸ¥è¯¢ ï¼ˆä½¿ç”¨ _search APIï¼‰</li>
<li>å°è¯•æ•°æ®åˆ†æèšåˆ ï¼ˆä½¿ç”¨ _search APIï¼‰</li>
<li>ä¸‹è½½å¹¶è¿è¡Œ Kibana æœåŠ¡å™¨</li>
</ol>
<p>æœ¬è¯¾ç¨‹çš„æ‰€æœ‰ç¨‹åºæ–‡ä»¶ã€è½¯ä»¶åŒ…çš„ä¸‹è½½åœ°å€å¦‚ä¸‹ï¼š</p>
<ul>
<li>ç™¾åº¦ç½‘ç›˜ https://pan.baidu.com/s/1fqLLEanfkmLYBZJBrKhiYQ</li>
<li>æå–ç ï¼š0kx6</li>
</ul>
<p>è¯·åœ¨ç½‘ç›˜æ–‡ä»¶åŠ ä¸­ï¼Œæ‰¾åˆ°å¯¹åº”è¯¾ç¨‹çš„ç›®å½•ï¼Œä¸‹è½½è¯¥ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶åˆ°æœ¬æœºï¼ˆmacOSï¼‰ï¼Œæˆ–è€…ä¸Šä¼ åˆ°äº‘ä¸»æœºä¸­ã€‚</p>
<h2 is-upgraded>å‚è€ƒä¿¡æ¯</h2>
<p>Elastic å®˜æ–¹å‚è€ƒæ–‡æ¡£ï¼š</p>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/getting-started.html" target="_blank">Getting started with Elasticsearch</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-discovery-settings.html" target="_blank">Discovery and cluster formation settings</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/bootstrap-checks.html#single-node-discovery" target="_blank">Bootstrap Checks</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-your-data.html" target="_blank">Search your data</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations.html" target="_blank">Aggregations</a></li>
</ul>
<p>Elastic Stack åŒ…å«äº†æˆ‘ä»¬å¸¸è¯´çš„ ELK æˆ–è€… ELKBã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š <img alt="9521567760281_.pic_hd" src="img/17da333e5e9ca6d6.jpg"></p>
<p>ELK æ˜¯ Elasticsearchã€Logstashå’ŒKininaçš„é¦–å­—æ¯ç¼©å†™ï¼ŒELK Stackæ˜¯elasticå…¬å¸ä¸‰å¤§æ ¸å¿ƒäº§å“çš„ç»„åˆæ–¹æ¡ˆã€‚</p>
<p class="image-container"><img alt="9521567760281_.pic_hd" src="img/df42341d371ed458.jpg"></p>


      </google-codelab-step>
    
      <google-codelab-step label="ç¯å¢ƒéœ€æ±‚æ£€æŸ¥" duration="2">
        <p>é¡ºåˆ©å®Œæˆæœ¬ Lab çš„ç¬”è®°æœ¬ç”µè„‘çš„è½¯ç¡¬ä»¶éœ€æ±‚å¦‚ä¸‹ã€‚</p>
<aside class="special"><p>å»ºè®®ä½¿ç”¨é…ç½®è¶³å¤Ÿçš„ç¬”è®°æœ¬ç”µè„‘ï¼Œåœ¨æœ¬æœºçš„å‘½ä»¤è¡Œç›´æ¥è¿è¡Œæœ¬ Lab çš„ç›¸å…³æ“ä½œï¼Œå·²è·å–æœ€ä½³ä½“éªŒã€‚</p>
</aside>
<h2 is-upgraded>ç¡¬ä»¶é…ç½®</h2>
<ul>
<li>4GB å†…å­˜æˆ–æ›´å¤š</li>
<li>i5 åŠæ›´é«˜ CPU</li>
<li>Wifi æˆ–æœ‰çº¿ç½‘ç»œï¼Œèƒ½è®¿é—®äº’è”ç½‘ã€‚</li>
</ul>
<h2 is-upgraded>è½¯ä»¶é…ç½®</h2>
<ul>
<li>MacOSã€Windows æˆ–è€… Linux æ“ä½œç³»ç»Ÿéƒ½å¯ä»¥ã€‚</li>
<li>ç»ˆç«¯å‘½ä»¤è¡Œå·¥å…·è½¯ä»¶ï¼Œä¾‹å¦‚ï¼š iTerm2ã€Terminalã€ <a href="https://cmder.net/" target="_blank">cmder for Windows 10</a>ã€‚</li>
<li>curlã€wget æˆ–è€…å…¶ä»–çš„å›¾å½¢åŒ–ä¸‹è½½å·¥å…·ã€‚</li>
</ul>
<aside class="warning"><p>æ‰“å¼€å‘½ä»¤è¡Œå·¥å…·è½¯ä»¶ï¼Œè¿›å…¥ä¸€ä¸ªå‡†å¤‡å¥½çš„ç©ºç›®å½•ã€‚</p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="è¿è¡Œ Elasticsearch æœåŠ¡å™¨" duration="5">
        <aside class="special"><p>åœ¨å®æ“ç»ƒä¹ çš„ç©ºç›®å½•ä¸­ä¸‹è½½ Elasticsearch æœåŠ¡å™¨è½¯ä»¶å‹ç¼©åŒ… tar.gz ç‰ˆæœ¬ï¼ˆé rpm æˆ– deb å®‰è£…åŒ…ï¼‰ã€‚</p>
</aside>
<h2 is-upgraded>ä¸‹è½½è½¯ä»¶å‹ç¼©åŒ…</h2>
<p>ä¸‹è½½ç¬¦åˆä½ çš„æ“ä½œç³»ç»Ÿç±»å‹çš„ Elasticsearch è½¯ä»¶åŒ…ã€‚</p>
<p>Linux:  <a href="https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.9.3-linux-x86_64.tar.gz" target="_blank">elasticsearch-7.9.3-linux-x86_64.tar.gz</a></p>
<pre><code language="language-bash" class="language-bash">curl -L -O https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.9.3-linux-x86_64.tar.gz
</code></pre>
<p>macOS:  <a href="https://artifacts.elastic.co/downloads/elasticsearch/
elasticsearch-7.9.3-darwin-x86_64.tar.gz" target="_blank">elasticsearch-7.9.3-darwin-x86_64.tar.gz</a></p>
<pre><code language="language-bash" class="language-bash">curl -L -O https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.9.3-darwin-x86_64.tar.gz
</code></pre>
<p>Windows:</p>
<p><a href="https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.9.3-windows-x86_64.zip" target="_blank"><paper-button class="colored" raised>elasticsearch-7.9.3-windows-x86_64.zip</paper-button></a></p>
<h2 is-upgraded>è§£å‹ç¼©è½¯ä»¶å‹ç¼©åŒ…</h2>
<p>è¿›å…¥ä¸‹è½½è½¯ä»¶åŒ…æ‰€åœ¨çš„ç›®å½•ä¸­ã€‚è§£å‹ç¼© Elasticsearch æœåŠ¡å™¨ç«¯è½¯ä»¶åŒ…ã€‚</p>
<p>Linux:</p>
<pre><code language="language-bash" class="language-bash">tar -xvf elasticsearch-7.9.3-linux-x86_64.tar.gz
</code></pre>
<p>macOS:</p>
<pre><code language="language-bash" class="language-bash">tar -xvf elasticsearch-7.9.3-darwin-x86_64.tar.gz
</code></pre>
<p>Windows PowerShell:</p>
<pre><code language="language-bash" class="language-bash">Expand-Archive elasticsearch-7.9.3-windows-x86_64.zip
</code></pre>
<h2 is-upgraded>å¯åŠ¨ Elasticsearch æœåŠ¡</h2>
<p>è¿›å…¥åŠ å‹ç¼©åçš„ç›®å½•ï¼Œå¹¶åœ¨å‘½ä»¤è¡Œå¯åŠ¨ Elasticsearch æœåŠ¡å™¨ã€‚</p>
<p>Linux å’Œ macOS:</p>
<pre><code language="language-bash" class="language-bash">cd elasticsearch-7.9.3/bin
./elasticsearch -Ecluster.name=1m-only -Ediscovery.type=single-node -Enode.name=node1 -Enetwork.host=0.0.0.0
</code></pre>
<p>Windows:</p>
<pre><code language="language-bash" class="language-bash">cd elasticsearch-7.9.3\bin
.\elasticsearch.bat -E cluster.name=1m-only -E discovery.type=single-node -E node.name=node1
</code></pre>
<p>åœ¨å¯åŠ¨æ—¥å¿—åœæ­¢æ»šåŠ¨åï¼Œä¸€ä¸ªåä¸º <code>1m-only</code> çš„å•èŠ‚ç‚¹ Elasticsearch é›†ç¾¤å°±å¯åŠ¨æˆåŠŸäº†ã€‚å¯åŠ¨æ˜¯å‚æ•°è¯´æ˜å¦‚ä¸‹ï¼š</p>
<ul>
<li>cluster.name ï¼š é›†ç¾¤åç§°</li>
<li>node.name : èŠ‚ç‚¹åç§°</li>
<li>discovery.type ï¼šé›†ç¾¤ä¸­èŠ‚ç‚¹é—´çš„å‘ç°æ–¹å¼ï¼Œæ˜¾å¼å£°æ˜è¯¥é›†ç¾¤ä¸­åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ã€‚</li>
</ul>
<p>åœ¨ä¸€ä¸ªæ–°çš„å‘½ä»¤è¡Œçª—å£ä¸­ç”¨ <code>curl</code> å‘½ä»¤è¡Œå·¥å…·æµ‹è¯• Elasticsearch é›†ç¾¤æœåŠ¡çš„çŠ¶æ€ã€‚</p>
<p>æŸ¥çœ‹æœåŠ¡çš„åŸºæœ¬ä¿¡æ¯ã€‚Linux å’Œ macOS:</p>
<p><code>curl -X GET http://localhost:9200</code></p>
<pre><code language="language-bash" class="language-bash">curl -X GET http://localhost:9200
{
  &#34;name&#34; : &#34;node1&#34;,
  &#34;cluster_name&#34; : &#34;1m-only&#34;,
  &#34;cluster_uuid&#34; : &#34;LvHOXakFTby0-uPwq_Ekiw&#34;,
  &#34;version&#34; : {
    &#34;number&#34; : &#34;7.9.3&#34;,
    &#34;build_flavor&#34; : &#34;default&#34;,
    &#34;build_type&#34; : &#34;tar&#34;,
    &#34;build_hash&#34; : &#34;c4138e51121ef06a6404866cddc601906fe5c868&#34;,
    &#34;build_date&#34; : &#34;2020-10-16T10:36:16.141335Z&#34;,
    &#34;build_snapshot&#34; : false,
    &#34;lucene_version&#34; : &#34;8.6.2&#34;,
    &#34;minimum_wire_compatibility_version&#34; : &#34;6.8.0&#34;,
    &#34;minimum_index_compatibility_version&#34; : &#34;6.0.0-beta1&#34;
  },
  &#34;tagline&#34; : &#34;You Know, for Search&#34;
}

</code></pre>
<p>æŸ¥çœ‹é›†ç¾¤çš„çŠ¶æ€ä¿¡æ¯ã€‚Linux å’Œ macOS:</p>
<p><code>curl -X GET http://localhost:9200/_cat/nodes\?v</code></p>
<pre><code language="language-bash" class="language-bash">curl -X GET http://localhost:9200/_cat/nodes\?v
ip        heap.percent ram.percent cpu load_1m load_5m load_15m node.role master name
127.0.0.1           17          97   7    2.05                  dilmrt    *      node1
</code></pre>
<p>ä¸Šé¢çš„ <code>master</code> é‚£ä¸€åˆ—ä¸‹é¢çš„å€¼ä¸º <code>*</code> å·ï¼Œè¡¨æ˜èŠ‚ç‚¹ <code>node1</code> æ˜¯ä¸»èŠ‚ç‚¹ã€‚</p>
<p>åœ¨æµè§ˆå™¨ä¸­éªŒè¯ Elasticsearch é›†ç¾¤æœåŠ¡çš„çŠ¶æ€ï¼Œæ‰“å¼€æµè§ˆå™¨ä¸­è®¿é—®è¿™ä¸ªç½‘å€ <code>http://localhost:9200</code> ã€‚è®¿é—®ç»“æœåº”å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p class="image-container"><img alt="2020-10-28_11-35-01" src="img/42317fb1250e878e.jpeg"></p>
<p>ç„¶åå°è¯•è®¿é—®è¿™ä¸ªç½‘å€ <code>http://localhost:9200/_cat/nodes\?v</code> ã€‚</p>
<aside class="warning"><p>ç¡®ä¿åœ¨å‘½ä»¤è¡Œå’Œæµè§ˆå™¨ä¸­éƒ½èƒ½çœ‹åˆ°æ­£ç¡®çš„é›†ç¾¤åç§°ã€èŠ‚ç‚¹åç§°å’Œè½¯ä»¶ç‰ˆæœ¬å·</p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="ç´¢å¼•ä¸€äº›æ–‡æ¡£" duration="8">
        <aside class="special"><p>è¿™ä¸ªæœ¬åœ°è¿è¡Œçš„ Elasticsearch é›†ç¾¤æä¾›ç€åŠŸèƒ½å®Œæ•´çš„ RESTFul API æœåŠ¡ï¼ŒåŒ…æ‹¬å¯¹æ–‡æ¡£çš„å¢åˆ æ”¹æŸ¥ï¼ˆCURDï¼‰ç­‰æ“ä½œã€‚</p>
</aside>
<h2 is-upgraded>ç´¢å¼•å•ä¸ªå’Œè¿”å›å•ä¸ªæ–‡æ¡£</h2>
<p>ç´¢å¼•ä¸€ä¸ªæ–‡æ¡£ï¼Œè¯¥æ–‡æ¡£åªå…·æœ‰ä¸€ä¸ªé”®å€¼å¯¹æ•°æ® &#34;name&#34;: &#34;John Doe&#34; ã€‚</p>
<pre><code language="language-bash" class="language-bash">curl -X PUT &#34;localhost:9200/customer/_doc/1?pretty&#34; -H &#39;Content-Type: application/json&#39; -d&#39;
{
  &#34;name&#34;: &#34;John Doe&#34;
}
&#39;
</code></pre>
<p>æ³¨æ„ï¼šä»¥ä¸Šå‘½ä»¤æœ€åä¸€è¡Œè¿˜æœ‰ä¸€ä¸ªå•å¼•å·ã€‚</p>
<p>ä»¥ä¸Šå‘½ä»¤çš„è¿”å›ç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code>{
  &#34;_index&#34; : &#34;customer&#34;,
  &#34;_type&#34; : &#34;_doc&#34;,
  &#34;_id&#34; : &#34;1&#34;,
  &#34;_version&#34; : 1,
  &#34;result&#34; : &#34;created&#34;,
  &#34;_shards&#34; : {
    &#34;total&#34; : 2,
    &#34;successful&#34; : 1,
    &#34;failed&#34; : 0
  },
  &#34;_seq_no&#34; : 0,
  &#34;_primary_term&#34; : 1
}
</code></pre>
<p>ä»¥ä¸Šçš„å‘½ä»¤åˆ›å»ºäº†åç§°ä¸º <code>customer</code> çš„æ–°ç´¢å¼•ï¼Œå¹¶ä¿å­˜äº†ç¬¬ä¸€ä¸ªç¼–å·ä¸º <code>1</code> çš„æ–‡æ¡£ã€‚</p>
<p>ç”¨ä¸‹é¢çš„å‘½ä»¤å–å›è¿™ä¸ªç¼–å·ä¸º <code>1</code> çš„æ–‡æ¡£ã€‚</p>
<pre><code>curl -X GET &#34;localhost:9200/customer/_doc/1?pretty&#34;

</code></pre>
<p>è¿”å›çš„ç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code>{
  &#34;_index&#34; : &#34;customer&#34;,
  &#34;_type&#34; : &#34;_doc&#34;,
  &#34;_id&#34; : &#34;1&#34;,
  &#34;_version&#34; : 1,
  &#34;_seq_no&#34; : 0,
  &#34;_primary_term&#34; : 1,
  &#34;found&#34; : true,
  &#34;_source&#34; : {
    &#34;name&#34; : &#34;John Doe&#34;
  }
}

</code></pre>
<h2 is-upgraded>æ‰¹é‡ç´¢å¼•æ–‡æ¡£</h2>
<p>åœ¨æœ‰å¤§é‡æ–‡æ¡£çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.9/docs-bulk.html" target="_blank">buck API</a> è¿›è¡Œæ‰¹é‡ç´¢å¼•ï¼ˆå¯¼å…¥ï¼‰çš„æ“ä½œã€‚</p>
<p>ä¸‹è½½æµ‹è¯•æ•°æ®æ–‡ä»¶ <a href="https://github.com/elastic/elasticsearch/blob/master/docs/src/test/resources/accounts.json?raw=true" target="_blank">accounts.json</a> ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸­æœ‰ä¸€åƒæ¡äººå·¥ç”Ÿæˆçš„æ•°æ®</p>
<p><a href="https://github.com/elastic/elasticsearch/blob/master/docs/src/test/resources/accounts.json?raw=true" target="_blank"><paper-button class="colored" raised>ç‚¹æ­¤ä¸‹è½½ account.json æ–‡ä»¶</paper-button></a></p>
<p>å°† <code>account.json</code> æ–‡ä»¶ä¸‹è½½åˆ°æµ‹è¯•ç›®å½•ä¸­ï¼Œç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€æµè§ˆç¡®è®¤ã€‚</p>
<p>åœ¨å‘½ä»¤è¡Œä¸­ï¼Œè¿›å…¥ä»¥ä¸Šæµ‹è¯•æ•°æ®æ–‡ä»¶çš„ç›®å½•ä¸­ï¼Œè¿è¡Œä¸‹é¢çš„ä¸¤æ¡å‘½ä»¤ã€‚</p>
<pre><code>curl -H &#34;Content-Type: application/json&#34; -XPOST &#34;localhost:9200/bank/_bulk?pretty&amp;refresh&#34; --data-binary &#34;@accounts.json&#34;
curl &#34;localhost:9200/_cat/indices?v&#34;
</code></pre>
<p>ä»¥ä¸Šå‘½ä»¤çš„ç»“æœï¼Œæœ€åä¸‰è¡Œåº”è¯¥å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code>health status index    uuid                   pri rep docs.count docs.deleted store.size pri.store.size
yellow open   bank     Q_yO2ErRSRSgCXHu6eac-g   1   1       1000            0    382.2kb        382.2kb
yellow open   customer D9ijmP_iR225damqVPQwkw   1   1          1            0      3.8kb          3.8kb
</code></pre>
<p>ä¸Šé¢çš„ç»“æœè¡¨æ˜ï¼šå½“å‰çš„é›†ç¾¤ä¸­å·²ç»åˆ›å»ºäº†ä¸¤ä¸ªç´¢å¼• <code>bank</code> å’Œ <code>customer</code> ; åä¸º <code>bank</code> çš„ç´¢å¼•æ˜¾ç¤ºæ–‡æ¡£æ•°ä¸º 1000ï¼Œè¿™å°±æ˜¯åˆšæ‰ç”¨ bulk API å¯¼å…¥çš„æ•°æ®ã€‚</p>
<p>å¦‚æœåœ¨æµè§ˆå™¨ä¸­è®¿é—®è¿™ä¸ªç½‘å€ localhost:9200/_cat/indices?v ä¹Ÿå¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç›¸åŒç»“æœã€‚</p>
<p class="image-container"><img alt="2020-10-28_12-58-30" src="img/fba2aff51dffabce.jpeg"></p>
<aside class="warning"><p><code>_doc</code> å’Œ <code>_bulk</code> API ç´¢å¼•äº†å•ä¸ªå’Œæ‰¹é‡çš„æ•°æ®æ–‡æ¡£ã€‚åä¸º <code>bank</code> å’Œ <code>customer</code> çš„ç´¢å¼•ä¹Ÿåœ¨è¿‡ç¨‹ä¸­è¢«åˆ›å»ºã€‚</p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="æµ‹è¯•æœç´¢åŠŸèƒ½" duration="6">
        <aside class="special"><p>ä½¿ç”¨ _search API è¿›è¡Œæœç´¢ï¼ŒElasticsearch <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html" target="_blank">Query DSL</a> æœ‰ä¸€æ•´å¥—çš„æœç´¢èƒ½åŠ›ã€‚</p>
</aside>
<h2 is-upgraded>æœç´¢ 1</h2>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>ç›®æ ‡ bank ç´¢å¼•</li>
<li>æœç´¢æ‰€æœ‰æ–‡æ¡£</li>
<li>ç»“æœæŒ‰ account_number å­—æ®µå‡åºæ’åˆ—</li>
</ul>
<p>åœ¨å‘½ä»¤è¡Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ã€‚</p>
<pre><code>curl -X GET &#34;localhost:9200/bank/_search?pretty&#34; -H &#39;Content-Type: application/json&#39; -d&#39;
{
  &#34;query&#34;: { &#34;match_all&#34;: {} },
  &#34;sort&#34;: [
    { &#34;account_number&#34;: &#34;asc&#34; }
  ]
}
&#39;
</code></pre>
<p>æ‰§è¡Œç»“æœè§£é‡Šï¼š</p>
<ul>
<li>took â€“ Elasticsearch æ‰§è¡Œæœ¬æ¬¡æŸ¥è¯¢ä½¿ç”¨äº†å¤šå°‘æ¯«ç§’</li>
<li>timed_out â€“ æ˜¯å¦æŸ¥è¯¢è¶…æ—¶</li>
<li>_shards â€“ æœ‰å¤šå°‘ä¸ªæ•°æ®åˆ†ç‰‡å‚ä¸äº†æœ¬æ¬¡æœç´¢ï¼ŒæŒ‰æˆåŠŸã€ç•¥è¿‡å’Œå¤±è´¥è®¡æ•°</li>
<li>max_score â€“ æ‰¾åˆ°çš„æœ€ç›¸å…³æ–‡æ¡£çš„ç›¸å…³åº¦åˆ†æ•°</li>
<li>hits.total.value - æ‰¾åˆ°äº†å¤šå°‘ä¸ªç›¸å…³æ–‡æ¡£</li>
<li>hits.sort - æ–‡æ¡£æ’åºå­—æ®µä½ç½®(åœ¨æ²¡æœ‰è®¾ç½®çš„æ—¶å€™ç”¨ç›¸å…³åº¦åˆ†æ•°æ’åº)</li>
<li>hits._score æ–‡æ¡£çš„ç›¸å…³åº¦åˆ†æ•°ï¼ˆåœ¨ match_all æ—¶ä¸é€‚ç”¨ï¼‰</li>
</ul>
<p>ä»¥ä¸Šå‘½ä»¤è¿”å›äº†æœç´¢ç»“æœçš„æ•´ä½“æ¦‚è¿°ä¿¡æ¯å’Œç¬¬ä¸€é¡µï¼ˆå‰ 10 æ¡æ–‡æ¡£ï¼‰çš„æœç´¢ç»“æœã€‚</p>
<h2 is-upgraded>æœç´¢ 2</h2>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>ç›®æ ‡ bank ç´¢å¼•</li>
<li>æœç´¢æ‰€æœ‰æ–‡æ¡£</li>
<li>ä»è¿”å›ç»“æœä¸­å–å‡ºç¬¬ 10 åˆ° 19 ä¸ªæ–‡æ¡£ã€‚  <ul>
<li>from ç»“æœçš„èµ·å§‹ä½ç½®</li>
<li>size è¿”å›çš„æ•°æ®æ¡æ•°</li>
</ul>
</li>
</ul>
<p>åœ¨å‘½ä»¤è¡Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ã€‚</p>
<pre><code>curl -X GET &#34;localhost:9200/bank/_search?pretty&#34; -H &#39;Content-Type: application/json&#39; -d&#39;
{
  &#34;query&#34;: { &#34;match_all&#34;: {} },
  &#34;sort&#34;: [
    { &#34;account_number&#34;: &#34;asc&#34; }
  ],
  &#34;from&#34;: 10,
  &#34;size&#34;: 10
}
&#39;
</code></pre>
<p>æ‰§è¡Œç»“æœè§£é‡Šï¼š</p>
<ul>
<li>åœ¨ 1000 ä¸ªæ–‡æ¡£ä¸­æˆåŠŸçš„æœç´¢åˆ° 10 ä¸ªæ–‡æ¡£</li>
<li>è¿”å›ç»“æœä¸­ _id ä» 10 æ»šåŠ¨åˆ° 19</li>
<li>å·¥è¿”å› 10 ä¸ªæ–‡æ¡£</li>
</ul>
<h2 is-upgraded>æœç´¢ 3</h2>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>ç›®æ ‡ bank ç´¢å¼•</li>
<li>æœç´¢æ‰€æœ‰åœ°å€ä¸­è¿˜æœ‰ <code>mill</code> å’Œ <code>lane</code> å…³é”®è¯çš„æ–‡æ¡£</li>
</ul>
<p>åœ¨å‘½ä»¤è¡Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ã€‚</p>
<pre><code>curl -X GET &#34;localhost:9200/bank/_search?pretty&#34; -H &#39;Content-Type: application/json&#39; -d&#39;
{
  &#34;query&#34;: { &#34;match&#34;: { &#34;address&#34;: &#34;mill lane&#34; } }
}
&#39;

</code></pre>
<p>æ‰§è¡Œç»“æœè§£é‡Šï¼š</p>
<ul>
<li>åœ¨ 1000 ä¸ªæ–‡æ¡£ä¸­æˆåŠŸçš„æœç´¢åˆ° 19 ä¸ªæ–‡æ¡£</li>
<li>è¿”å›ç»“æœä¸­è§‚å¯Ÿ <code>address</code> è¿™ä¸ªå­—æ®µçš„è¿”å›å€¼</li>
<li>é»˜è®¤åªæ˜¾ç¤ºå‰ 10 æ¡æ•°æ®</li>
<li>æ–‡æ¡£ç›¸å…³æ€§æœ€é«˜åˆ†æ˜¯ 9.507477</li>
<li>ç›¸å…³æ€§æœ€é«˜çš„æ–‡æ¡£ï¼Œaddress å­—æ®µä¸­åŒæ—¶åŒ…å«äº†  <code>mill</code> å’Œ <code>lane</code> ä¸¤ä¸ªå…³é”®è¯ã€‚</li>
</ul>
<h2 is-upgraded>æœç´¢ 4</h2>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>ç›®æ ‡ bank ç´¢å¼•</li>
<li>æœç´¢æ‰€æœ‰å¹´é¾„ä¸º 40 ä¸”ä¸å±…ä½åœ¨ â€˜ID&#39; å·çš„è´¦å·ã€‚</li>
</ul>
<p>åœ¨å‘½ä»¤è¡Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ã€‚</p>
<pre><code>curl -X GET &#34;localhost:9200/bank/_search?pretty&#34; -H &#39;Content-Type: application/json&#39; -d&#39;
{
  &#34;query&#34;: {
    &#34;bool&#34;: {
      &#34;must&#34;: [
        { &#34;match&#34;: { &#34;age&#34;: &#34;40&#34; } }
      ],
      &#34;must_not&#34;: [
        { &#34;match&#34;: { &#34;state&#34;: &#34;ID&#34; } }
      ]
    }
  }
}
&#39;
</code></pre>
<p>æ‰§è¡Œç»“æœè§£é‡Šï¼š</p>
<ul>
<li>åœ¨ 1000 ä¸ªæ–‡æ¡£ä¸­æˆåŠŸçš„æœç´¢åˆ° 43 ä¸ªæ–‡æ¡£</li>
<li>è¿”å›ç»“æœä¸­è§‚å¯Ÿ <code>age</code> è¿™ä¸ªå­—æ®µçš„éƒ½æ˜¯ <code>40</code></li>
<li>è¿”å›ç»“æœä¸­è§‚å¯Ÿ <code>state</code> è¿™ä¸ªå­—æ®µçš„å€¼éƒ½ä¸æ˜¯ <code>ID</code></li>
</ul>
<h2 is-upgraded>æœç´¢ 5</h2>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>ç›®æ ‡ bank ç´¢å¼•</li>
<li>æœç´¢æ‰€æœ‰è´¦å·</li>
<li>è¿”å›è´¦æˆ·ä½™é¢é‡‘é¢ <code>balance</code> åœ¨ 20000 åˆ° 30000 ä¹‹é—´çš„æ•°æ®</li>
</ul>
<p>åœ¨å‘½ä»¤è¡Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ã€‚</p>
<pre><code>curl -X GET &#34;localhost:9200/bank/_search?pretty&#34; -H &#39;Content-Type: application/json&#39; -d&#39;
{
  &#34;query&#34;: {
    &#34;bool&#34;: {
      &#34;must&#34;: { &#34;match_all&#34;: {} },
      &#34;filter&#34;: {
        &#34;range&#34;: {
          &#34;balance&#34;: {
            &#34;gte&#34;: 20000,
            &#34;lte&#34;: 30000
          }
        }
      }
    }
  }
}
&#39;
</code></pre>
<p>æ‰§è¡Œç»“æœè§£é‡Šï¼š</p>
<ul>
<li>åœ¨ 1000 ä¸ªæ–‡æ¡£ä¸­æˆåŠŸçš„æœç´¢åˆ° 217 ä¸ªæ–‡æ¡£</li>
<li>åœ¨è¿”å›ç»“æœä¸­è§‚å¯Ÿ <code>balance</code>  çš„æ•°å€¼æ˜¯å¦æ»¡è¶³æœç´¢æ¡ä»¶</li>
</ul>
<aside class="warning"><p>é€šè¿‡ <code>_search</code> API æˆåŠŸçš„å®Œæˆäº† 5 ä¸ªç›®çš„ä¸åŒçš„æœç´¢æ“ä½œï¼Œä½“ä¼š Elasticsearch çš„æœç´¢èƒ½åŠ›ã€‚</p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="æœç´¢ç»“æœçš„èšåˆåˆ†æ" duration="6">
        <aside class="special"><p>Elasticsearch å¯ä»¥åœ¨æœç´¢ç»“æœä¸­è¿›è¡Œèšåˆåˆ†æ  <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations.html" target="_blank">Aggregations</a> ï¼Œé€šè¿‡å„ç§ç»“æ„æ±‡è®¡ç®—æ€»æœç´¢ç»“æœæ•°æ®ã€‚</p>
</aside>
<h2 is-upgraded>èšåˆè¿ç®— 1</h2>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>ä¸æ˜¯è®¾ç½®ä»»ä½•æœç´¢æ¡ä»¶ï¼Œåœ¨æ‰€æœ‰æ–‡æ¡£ä¸­åšèšåˆè¿ç®—</li>
<li>ä¸è¿”å›ä»»ä½•æ–‡æ¡£ size = 0</li>
<li>ç”¨ state ä½œä¸ºå…³é”®å­—åˆ†ç»„æŸ¥è¯¢ç»“æœ</li>
</ul>
<p>åœ¨å‘½ä»¤è¡Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ã€‚</p>
<pre><code>curl -X GET &#34;localhost:9200/bank/_search?pretty&#34; -H &#39;Content-Type: application/json&#39; -d&#39;
{
  &#34;size&#34;: 0,
  &#34;aggs&#34;: {
    &#34;group_by_state&#34;: {
      &#34;terms&#34;: {
        &#34;field&#34;: &#34;state.keyword&#34;
      }
    }
  }
}
&#39;
</code></pre>
<p>æ‰§è¡Œç»“æœè§£é‡Šï¼š</p>
<ul>
<li>hits æ€»å…±æœç´¢äº† 1000 ä¸ªæ–‡æ¡£</li>
<li>åœ¨ aggregations æŸ¥çœ‹æ¯ä¸ªå·çš„é“¶è¡Œè´¦æˆ·æ€»ä¸ªæ•°</li>
</ul>
<h2 is-upgraded>èšåˆè¿ç®— 2</h2>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>ä¸æ˜¯è®¾ç½®ä»»ä½•æœç´¢æ¡ä»¶ï¼Œåœ¨æ‰€æœ‰æ–‡æ¡£ä¸­åšèšåˆè¿ç®—</li>
<li>ä¸è¿”å›ä»»ä½•æ–‡æ¡£ size = 0</li>
<li>ç”¨ state ä½œä¸ºå…³é”®å­—åˆ†ç»„æŸ¥è¯¢ç»“æœ</li>
<li>è®¡ç®—æ¯ä¸ªå·é“¶è¡Œè´¦æˆ·é‡Œçš„ä½™é¢çš„å¹³å‡å€¼</li>
<li>é»˜è®¤ä»¥æ¯ä¸ªå·çš„è´¦æˆ·æ•°é‡æ’åºç»“æœ</li>
</ul>
<p>åœ¨å‘½ä»¤è¡Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ã€‚</p>
<pre><code>curl -X GET &#34;localhost:9200/bank/_search?pretty&#34; -H &#39;Content-Type: application/json&#39; -d&#39;
{
  &#34;size&#34;: 0,
  &#34;aggs&#34;: {
    &#34;group_by_state&#34;: {
      &#34;terms&#34;: {
        &#34;field&#34;: &#34;state.keyword&#34;
      },
      &#34;aggs&#34;: {
        &#34;average_balance&#34;: {
          &#34;avg&#34;: {
            &#34;field&#34;: &#34;balance&#34;
          }
        }
      }
    }
  }
}
&#39;
</code></pre>
<p>æ‰§è¡Œç»“æœè§£é‡Šï¼š</p>
<ul>
<li>ç»“æœåŒä¸Šä¸€ä¸ªèšåˆ</li>
<li>å¦å¤–å¢åŠ äº†æ¯ä¸ªå·çš„æ‰€æœ‰é“¶è¡Œè´¦æˆ·çš„ä½™é¢æ±‚å¹³å‡å€¼è¿ç®—</li>
</ul>
<h2 is-upgraded>èšåˆè¿ç®— 3</h2>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>å…¶å®ƒåŠŸèƒ½åŒä¸Š</li>
<li>ç”¨æ¯ä¸ªå·çš„å¹³å‡è´¦æˆ·ä½™é¢ä»å¤§åˆ°å°æ’åºç»“æœ</li>
</ul>
<p>åœ¨å‘½ä»¤è¡Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ã€‚</p>
<pre><code>curl -X GET &#34;localhost:9200/bank/_search?pretty&#34; -H &#39;Content-Type: application/json&#39; -d&#39;
{
  &#34;size&#34;: 0,
  &#34;aggs&#34;: {
    &#34;group_by_state&#34;: {
      &#34;terms&#34;: {
        &#34;field&#34;: &#34;state.keyword&#34;,
        &#34;order&#34;: {
          &#34;average_balance&#34;: &#34;desc&#34;
        }
      },
      &#34;aggs&#34;: {
        &#34;average_balance&#34;: {
          &#34;avg&#34;: {
            &#34;field&#34;: &#34;balance&#34;
          }
        }
      }
    }
  }
}
&#39;
</code></pre>
<p>æ‰§è¡Œç»“æœè§£é‡Šï¼š</p>
<ul>
<li>è§‚å¯Ÿ bucket é‡Œçš„èšåˆç»“æœ</li>
<li>æŒ‰æ¯ä¸ªå·çš„æ‰€æœ‰é“¶è¡Œè´¦æˆ·çš„å¹³å‡å€¼å€’æ’åº</li>
</ul>
<aside class="warning"><p>é€šè¿‡ <code>_search</code> API ä¸­çš„ <code>aggs</code> è¿ç®—æˆåŠŸçš„å®Œæˆäº† 3 ä¸ªç›®çš„ä¸åŒçš„æœç´¢ç»“æœèšåˆè¿ç®—æ“ä½œï¼Œä½“ä¼š Elasticsearch çš„æ•°æ®æœç´¢åçš„èšåˆè¿ç®—åˆ†æèƒ½åŠ›ã€‚</p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="è¿è¡Œå’Œä½¿ç”¨ Kibana æœåŠ¡å™¨" duration="8">
        <aside class="special"><p>ä¸‹è½½å¹¶è¿è¡Œ Kibana è½¯ä»¶åŒ…ï¼Œä½¿ç”¨ Kibana çš„å›¾å½¢ç•Œé¢æœç´¢ bank ç´¢å¼•ä¸­çš„æ•°æ®ã€‚</p>
</aside>
<h2 is-upgraded>ä¸‹è½½åè¿è¡Œ Kibana</h2>
<p>åœ¨ Linux ä¸Šè¿è¡Œä¸‹é¢çš„å‘½ä»¤ã€‚</p>
<pre><code>curl -O https://artifacts.elastic.co/downloads/kibana/kibana-7.9.3-linux-x86_64.tar.gz
curl https://artifacts.elastic.co/downloads/kibana/kibana-7.9.3-linux-x86_64.tar.gz.sha512 | shasum -a 512 -c - 
tar -xzf kibana-7.9.3-linux-x86_64.tar.gz
cd kibana-7.9.3-linux-x86_64/
</code></pre>
<p>æˆ–è€… macOS ä¸Šè¿è¡Œä¸‹é¢çš„å‘½ä»¤ã€‚</p>
<pre><code>curl -O https://artifacts.elastic.co/downloads/kibana/kibana-7.9.3-darwin-x86_64.tar.gz
curl https://artifacts.elastic.co/downloads/kibana/kibana-7.9.3-darwin-x86_64.tar.gz.sha512 | shasum -a 512 -c - 
tar -xzf kibana-7.9.3-darwin-x86_64.tar.gz
cd kibana-7.9.3-darwin-x86_64/
</code></pre>
<p>æˆ–è€… Windows ä¸Šæ“ä½œå¦‚ä¸‹ã€‚</p>
<p>ä¸‹è½½ zip å‹ç¼©åŒ…ã€‚</p>
<p><a href="https://artifacts.elastic.co/downloads/kibana/kibana-7.9.3-windows-x86_64.zip" target="_blank"><paper-button class="colored" raised>ç‚¹æ­¤ä¸‹è½½ kibana-7.9.3-windows-x86_64.zip </paper-button></a></p>
<p>è§£å‹åè¿›å…¥ Kibana è¿è¡Œç›®å½•ï¼Œä»å‘½ä»¤è¡Œå¯åŠ¨ Kibana æœåŠ¡å™¨ã€‚</p>
<pre><code>CD c:\kibana-7.9.3-windows-x86_64
.\bin\kibana.bat
</code></pre>
<h2 is-upgraded>ç™»å½• Kibana æ§åˆ¶å°å¯¼å…¥&amp;æŸ¥çœ‹ç¤ºä¾‹æ•°æ®</h2>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒElasticsearch é›†ç¾¤è¿è¡Œåœ¨æ— å¯†ç çš„å¼€å‘æ¨¡å¼ï¼Œå› æ­¤æ— éœ€è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚</p>
<p>æ‰“å¼€æµè§ˆå™¨è®¿é—®ç½‘å€ <code>localhost:5601</code><img alt="2020-10-28_23-42-23" src="img/9beded45d1dd0cea.jpeg"></p>
<p>åœ¨è¿›å…¥ Kibana å›¾å½¢ç•Œé¢åï¼Œç‚¹å‡» <code>Load a data set and a Kibana dashboard</code> é“¾æ¥ã€‚</p>
<p class="image-container"><img alt="2020-10-28_23-43-26" src="img/9eae98193edf845e.jpeg"></p>
<p>åˆ†åˆ«ç‚¹å‡»è¿™ä¸‰ä¸ªæŒ‰é’®ï¼Œå¯¼å…¥ä¸‰ç»„ç¤ºä¾‹æ•°æ®ã€‚</p>
<p class="image-container"><img alt="2020-10-28_23-44-23" src="img/58d8b71d301a2532.jpeg"></p>
<p>ç‚¹å‡» Dashboard æŸ¥çœ‹æ•°æ®åˆ†æä»ªè¡¨æ¿ã€‚</p>
<h2 is-upgraded>åˆ›å»º bank ç´¢å¼•æ¨¡å¼&amp;æŸ¥çœ‹æ•°æ®</h2>
<p>ä¸ºäº†åœ¨å›¾å½¢ç•Œé¢ä¸­åˆ›å»ºç”¨äºåˆ†æ bank ç´¢å¼•ä¸­æ‰€æœ‰æ•°æ®çš„ <code>ç´</code>¢å¼•æ¨¡å¼ã€‚</p>
<p class="image-container"><img alt="2020-10-28_23-45-56" src="img/dec94ab188575062.jpeg"></p>
<p>ç‚¹å‡»å·¦ä¸Šè§’çš„æŒ‰é’®æ‰“å¼€å·¦ä¾§èœå•ï¼Œç‚¹å‡» Stack Management èœå•ã€‚</p>
<p class="image-container"><img alt="2020-10-28_23-46-21" src="img/f505c15871728ed4.jpeg"></p>
<p>åœ¨ Kibana ç®¡ç†é€‰é¡¹ä¸­ï¼Œç‚¹å‡»åˆ›å»ºç´¢å¼•æ¨¡å¼æŒ‰é’®ã€‚</p>
<p class="image-container"><img alt="2020-10-28_23-48-38" src="img/13001b96d410479d.jpeg"></p>
<p>åœ¨ç´¢å¼•æ¨¡å¼åç§°ä¸­è¾“å…¥ bank ï¼Œ ç‚¹å‡»å…ˆä¸€æ­¥ç›´åˆ°åˆ›å»ºå®Œæˆã€‚</p>
<p class="image-container"><img alt="2020-10-28_23-51-14" src="img/1374d328237742ba.jpeg"></p>
<p>ç‚¹å‡»å·¦ä¸Šè§’çš„æŒ‰é’®ï¼Œæ‰“å¼€å·¦ä¾§èœå•æ ï¼Œç‚¹å‡» Kibana éƒ¨åˆ†çš„ Discover é“¾æ¥ã€‚</p>
<p class="image-container"><img alt="2020-10-28_23-51-53" src="img/8e1af133619afab8.jpeg"></p>
<p>ç‚¹å‡»å·¦ä¾§çš„å‘ä¸‹ä¸‰è§’å›¾æ ‡ï¼Œæ‰“å¼€ç´¢å¼•é€‰æ‹©èœå•ï¼Œé€‰ä¸­åˆšæ‰åˆ›å»ºçš„ bank ç´¢å¼•æ¨¡å¼ã€‚</p>
<p class="image-container"><img alt="2020-10-28_23-54-33" src="img/9df60b0c4b57e172.jpeg"></p>
<p>å‚è€ƒå·¦ä¾§çš„å¯ç”¨å­—æ®µï¼Œè¿™æ˜¯ bank ç´¢å¼•çš„æ‰€æœ‰å­—æ®µã€‚ç‚¹å‡»ç¬¬ä¸€æ¡æ•°æ®çš„å‘ä¸‹æŒ‰é’®ï¼ŒæŸ¥çœ‹è¯¥æ–‡æ¡£ã€‚</p>
<aside class="warning"><p>æˆåŠŸçš„å¯¼å…¥å’ŒæŸ¥çœ‹äº† Kibana äº§å“é™„å¸¦çš„ä¸‰ç»„ç¤ºä¾‹æ•°æ®ã€‚ä½¿ç”¨ Kibana å›¾å½¢ç•Œé¢æ¢ç´¢äº†æ‰¹é‡å¯¼å…¥çš„ bank ç´¢å¼•ä¸­çš„æ•°æ®ã€‚</p>
</aside>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
